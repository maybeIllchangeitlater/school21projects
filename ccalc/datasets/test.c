/*
 * DO NOT EDIT THIS FILE. Generated by checkmk.
 * Edit the original source file "tests.check" instead.
 */

#include <check.h>

#include <check.h>
#include <math.h>
#include <stdlib.h>
#include "../src/s21_to_curva.h"

START_TEST(test_1_correct)
{
    double res_kurva = 0.0, res_og = 0.0;
    const char * string = "(-Sin(0.5) + Cos(0.5) + Tan(0.5) + ATan(0.5) + ACos(0.5) + ASin(0.5)*5)/0.3^2+sqrt(9)-mod(7,3)--5 + 3!/2! + ln(3) - log(2)";
    char result[255] = {0};
    solve(string, result);
    res_kurva = atof(result);
    res_og = (-sin(0.5) + cos(0.5) + tan(0.5) + atan(0.5) + acos(0.5) + asin(0.5)*5)/pow(0.3,2)+sqrt(9)-fmod(7,3)+5 + 6/2 + log(3) - log10(2);
    ck_assert_float_eq(res_kurva, res_og);

}
END_TEST

START_TEST(test_2_incorrect)
{
    char* test = "()))";
    char * kurvanull = "ERROR";
    char tested[255] = {0};
    solve(test ,tested);
    ck_assert_str_eq(kurvanull, tested);

}
END_TEST

START_TEST(test_3_incorrect)
{
    char* test1 = "spinus(15)";
    char * kurvanull1 = "ERROR";
    char tested1[255] = {0};
    solve(test1 ,tested1);
    ck_assert_str_eq(kurvanull1, tested1);

}
END_TEST

START_TEST(test_4_incorrect)
{
    char* test2 = "15*/7";
    char * kurvanull2 = "ERROR";
    char tested2[255] = {0};
    solve(test2 ,tested2);
    ck_assert_str_eq(kurvanull2, tested2);

}
END_TEST

START_TEST(test_5_incorrect)
{
    char* test3 = "7*8/";
    char * kurvanull3 = "ERROR";
    char tested3[255] = {0};
    solve(test3 ,tested3);
    ck_assert_str_eq(kurvanull3, tested3);

}
END_TEST

START_TEST(test_6_deposit)
{
	Deposit pp = {0};
    pp.deposit = 100.0;
    pp.interest = 10.0;
    pp.term = 10;
    pp.pereodicity = 1;
    pp.withdrawal = calloc(pp.term, sizeof(double));
    pp.replenishment = calloc(pp.term, sizeof(double ));
    pp.tax = 1;
    pp.capitalization = 0;
    calc_deposit(&pp);
    free(pp.withdrawal);
    free(pp.replenishment);
    ck_assert_float_eq(pp.res_accuired_interest, 100);
    ck_assert_float_eq(pp.res_tax_amount, 1);
    ck_assert_float_eq(pp.res_deposit_amount, 199);

}
END_TEST

START_TEST(test_7_credit)
{
    Credit res = {0};
    gib_gredit(&res, 100, 10, 10, 1);
    ck_assert_double_eq_tol(res.monthly_payment, 10.464, 0.001);
    ck_assert_double_eq_tol(res.overpay, 4.64048, 0.00001);
    ck_assert_double_eq_tol(res.total_payment, 104.64, 0.01);


}
END_TEST

START_TEST(test_8_credit_2)
{
    Credit res = {0};
    gib_gredit(&res, 100, 10, 10, 2);
    ck_assert_float_eq_tol(res.monthly_payment, 10, 0.1);
    ck_assert_float_eq_tol(res.overpay, 4.58333, 0.00001);
    ck_assert_float_eq_tol(res.total_payment, 104.583, 0.001);

}
END_TEST

int main(void)
{
    Suite *s1 = suite_create("Core");
    TCase *tc1_1 = tcase_create("Core");
    SRunner *sr = srunner_create(s1);
    int nf;

    suite_add_tcase(s1, tc1_1);
    tcase_add_test(tc1_1, test_1_correct);
    tcase_add_test(tc1_1, test_2_incorrect);
    tcase_add_test(tc1_1, test_3_incorrect);
    tcase_add_test(tc1_1, test_4_incorrect);
    tcase_add_test(tc1_1, test_5_incorrect);
    tcase_add_test(tc1_1, test_6_deposit);
    tcase_add_test(tc1_1, test_7_credit);
    tcase_add_test(tc1_1, test_8_credit_2);

    srunner_run_all(sr, CK_ENV);
    nf = srunner_ntests_failed(sr);
    srunner_free(sr);

    return nf == 0 ? 0 : 1;
}
