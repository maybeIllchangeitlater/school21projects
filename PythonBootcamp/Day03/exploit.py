from bs4 import BeautifulSoup


class HtmlIsSoFuuu(object):

    def __int__(self, filename: str):
        with open(filename) as target:
            self.soup = BeautifulSoup(target, 'html.parser')
        return self

    def change_title(self, string: str) -> None:
        self.soup.title.string = string

    def inject_into_body_user(self, tag: str, pronoun: str, name: str, string: str) -> None:
        new_tag = self.soup.new_tag(tag)
        self.soup.find('body').insert(0, new_tag)
        new_name = self.soup.new_tag('span class="name"')
        new_pronoun = self.soup.new_tag('span class="pronoun"')
        new_name.append(new_pronoun)
        new_pronoun.string = pronoun
        new_tag.append(new_name)
        new_name.append(name)
        new_tag.append(string)

    def inject_into_body_script(self, script_body: str) -> None:
        script_tag = self.soup.new_tag('script')
        script_tag.string = script_body
        self.soup.find('body').append(script_tag)

    def change_wiki_link(self, current: str, new: str, new_name: str) -> None:
        old = self.soup.find('a', href=current)
        old['href'] = new
        old.string = new_name

    def save_new_html(self, link: str) -> None:
        with open(link, 'w') as file:
            file.write(str(self.soup))


def main():
    hax = HtmlIsSoFuuu().__int__('evilcorp.html')
    hax.change_title("Evil Corp - Stealing your money every day")
    hax.change_wiki_link('https://mrrobot.fandom.com/wiki/E_Corp', 'https://mrrobot.fandom.com/wiki/Fsociety',
                         'Fsociety')
    script_string = """
        hacked = function() {
            alert('hacked');
        }
        window.addEventListener('load', 
          function() { 
            var f = document.querySelector("form");
            f.setAttribute("onsubmit", "hacked()");
          },
          false
        );
    """
    hax.inject_into_body_script(script_string)
    hax.inject_into_body_user('h1', 'Mr.', 'Robot, ', 'you are hacked!')
    hax.save_new_html("evilcorp_hacked.html")


if __name__ == '__main__':
    main()
